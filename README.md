# mybatis-plus-enhancer

[![Maven Central](https://img.shields.io/maven-central/v/io.github.bootystar/mybatis-plus-enhancer)](https://mvnrepository.com/artifact/io.github.bootystar/mybatis-plus-enhancer)
[![License](https://img.shields.io/badge/license-Apache%202.0-blue.svg)](LICENSE)
[![GitHub](https://img.shields.io/github/stars/bootystar/mybatis-plus-enhancer?style=social)](https://github.com/bootystar/mybatis-plus-enhancer)

English | [中文](README_ZH.md)

An enhancement toolkit for MyBatis-Plus that provides dynamic SQL building, IService and BaseMapper enhancements, and Excel import/export support.

## Features

- **Suffix SQL Building**: Automatically map different query types with `field`+`suffix`
- **Dynamic SQL Building**: Support dynamic condition splicing based on input parameters
- **Join Table Property Query**: Support automatic mapping of non-table field queries
- **Map Query Conditions**: Automatically convert Map parameters
- **Data Field Mapping**: Automatically convert properties to database fields
- **SQL Injection Prevention**: Prevent SQL injection through prepared SQL
- **Lambda Chaining Calls**: Support chaining calls to append parameter conditions
- **VO Type Conversion**: Automatically convert query results to specified classes
- **BaseMapper Enhancement**: Add `voById`, `voList`, `voPage` and other methods
- **IService Query Enhancement**: Add `voById`, `voList`, `voPage` and other methods
- **IService Business Enhancement**: Add `insertByDTO`, `updateByDTO` and other methods
- **IService Excel Integration**: Integrate `FastExcel` and `EasyExcel`, support Excel import/export

## Repository

- GitHub: https://github.com/bootystar/mybatis-plus-enhancer
- Maven Central: https://central.sonatype.com/artifact/io.github.bootystar/mybatis-plus-enhancer

## Installation

```xml
<dependency>
    <groupId>io.github.bootystar</groupId>
    <artifactId>mybatis-plus-enhancer</artifactId>
    <version>latest</version>
</dependency>
```

Current latest version: [![Maven Central](https://img.shields.io/maven-central/v/io.github.bootystar/mybatis-plus-enhancer)](https://mvnrepository.com/artifact/io.github.bootystar/mybatis-plus-enhancer)

## Quick Start

### 1. Create MyBatis-Plus Entity and BaseMapper
If you already have MyBatis-Plus entities and BaseMapper, you can skip this step

```java
@TableName("sys_user")
public class SysUser {
    @TableId(type = IdType.AUTO)
    private Long id;
    private String name;
    private Integer age;
    // getter/setter...
}
```
```java
public interface SysUserMapper extends BaseMapper<SysUser> {
    
}
```

### 2. Extend Mapper Interface
* Create or specify a `VO class` for displaying query results
* Make the `mapper` interface extend [EnhancedMapper](src/main/java/io/github/bootystar/mybatisplus/enhancer/EnhancedMapper.java), and specify the generic type as VO class
* Use `utility class` to get `mapper.xml` content, and copy it to the corresponding xml file
* (Optional) If there is a service layer, you can make the service implement [EnhancedService](src/main/java/io/github/bootystar/mybatisplus/enhancer/EnhancedService.java) interface to have all the methods of the mapper

```java
// VO class for encapsulating query results, can inherit from entity class or use entity class directly
public class SysUserVO {
    private Long id;
    private String name;
    private Integer age;
    // getter/setter...
}
```
```java
// Mapper interface file, make it extend EnhancedMapper interface
public interface SysUserMapper extends BaseMapper<SysUser>, 
        EnhancedMapper<SysUserVO> {
}
```

```java
import io.github.bootystar.mybatisplus.enhancer.util.MapperUtil;

// Get mapper.xml file sql fragment through utility class
public static void main(String[] args) {
    var mapperContent = MapperUtil.getMapperContent(SysUserMapper.class);
    System.out.println(mapperContent);
}
```
```xml
<!--Copy the sql fragment generated by the utility class to the mapper.xml file-->
<select id="voQueryByXml" resultType="com.example.test.vo.SysUserVO">
    SELECT a.* FROM sys_user a
    <where>
        <include refid="io.github.bootystar.mybatisplus.enhancer.EnhancedMapper.dynamicSelect"/>
    </where>
    <trim prefix="ORDER BY" prefixOverrides=",">
        <include refid="io.github.bootystar.mybatisplus.enhancer.EnhancedMapper.dynamicSort"/>
    </trim>
</select>
```

### 3. Usage Examples

```java
import io.github.bootystar.mybatisplus.enhancer.query.helper.SqlHelper;
import lombok.SneakyThrows;

import java.util.List;
import java.util.Map;

@RestController
@RequestMapping("/user")
public class SysUserController {

    @Autowired
    private SysUserService sysUserService;

    // Query VO by ID
    @GetMapping("/{id}")
    public SysUserVO getUserById(@PathVariable Long id) {
        return sysUserService.voById(id);
    }

    // Query by DTO object
    @PostMapping("/dto")
    public List<SysUserVO> getUsersByDTO(@RequestBody SysUserDTO dto) {
        return sysUserService.voList(dto);
    }

    // Query by map conditions (support suffix mapping for different query types)
    @PostMapping("/map")
    public List<SysUserVO> getUsersByMap(@RequestBody Map<String, Object> params) {
        return sysUserService.voList(params);
    }

    // Dynamic sql query with input parameters
    @PostMapping("/sql")
    public List<SysUserVO> getUsersBySql(@RequestBody SqlHelper<SysUser> sqlHelper) {
        return sysUserService.voList(sqlHelper);
    }

    // Lambda call, encapsulate required conditions
    @PostMapping("/lambda")
    public List<SysUserVO> getUsersBySql(@RequestBody Map<String, Object> params) {
        return SqlHelper.of(SysUser.class)
                .with(params) // Add parameters, support entity class, DTO object, map, SqlHelper, etc.
                .eq(SysUser::getState,1) // state=1
                .ge(SysUser::getAge, 18) // age>=18
                .like(SysUser::getUserName, "tom") // userName like '%tom%'
                .wrap(sysUserService)
                .voList();
    }

    // Page query
    @PostMapping("/page/{current}/{size}")
    public IPage<SysUserVO> getUserPage(@RequestBody Map<String, Object> params,
                                        @PathVariable("current") Long current,
                                        @PathVariable("size") Long size) {
        return sysUserService.voPage(params, current, size);
    }

    // Excel import
    @PostMapping("/excel/import")
    public int importExcel(@RequestParam("file") MultipartFile file) {
        // Return number of imported records
        return sysUserService.importExcel(file, SysUserVO.class);
    }

    // Excel export
    @PostMapping("/excel/export")
    public void exportExcel(HttpServletResponse response) throws IOException {
        String fileName = "user_list.xlsx";
        response.setContentType("application/vnd.openxmlformats-officedocument.spreadsheetml.sheet");
        response.setHeader("Content-Disposition", "attachment; filename=" + URLEncoder.encode(fileName, "UTF-8"));
        sysUserService.exportExcel(response.getOutputStream(), SysUserVO.class);
    }
}
```

For Java code usage examples, please refer to: [Examples](src/test/java/com/example)

## Core Features

### Suffix Query
With suffix queries, you can easily implement various query requirements.

```json
{
  "nameLike": "John",
  "ageGe": 18,
  "ageLt": 60,
  "stateIn": [1, 2, 3]
}
```

Supported suffix types:
- `Eq` - Equal (default)
- `Ne` - Not equal
- `Lt` - Less than
- `Le` - Less than or equal
- `Gt` - Greater than
- `Ge` - Greater than or equal
- `Like` - Fuzzy matching
- `NotLike` - Not fuzzy matching
- `In` - IN query
- `NotIn` - NOT IN query
- `IsNull` - IS NULL
- `IsNotNull` - IS NOT NULL

### Lambda Chaining Calls
Support Lambda expression chaining calls to build query conditions:

```java
List<SysUserVO> list = SqlHelper.of(SysUser.class)
    .eq(SysUser::getState, 1)
    .ge(SysUser::getAge, 18)
    .like(SysUser::getName, "J")
    .orderByDesc(SysUser::getCreateTime)
    .wrap(userService)
    .voList();
```

### DTO Query
Support querying through DTO objects, fields in DTO will be automatically mapped to database fields:

```java
public class SysUserSelectDTO {
    private String nameLike;
    private Integer ageGe;
    private Integer ageLt;
    private List<Integer> stateIn;
    // getter/setter...
}

SysUserSelectDTO dto = new SysUserSelectDTO();
dto.setNameLike("John");
dto.setAgeGe(18);
List<SysUserVO> list = userService.voList(dto);
```

### Excel Import/Export
Support Excel import/export functionality based on FastExcel:

```java
// Export Excel
userService.exportExcel(outputStream, SysUserVO.class);

// Import Excel
int count = userService.importExcel(file, SysUserVO.class);
```

## Configuration

### application.yml

```yaml
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
logging:
  level:
    org.apache.ibatis: debug
    java.sql: debug
```

## More Examples

Please refer to [Test Cases](src/test/java/com/example) for more usage examples.

## License

[Apache License 2.0](LICENSE)